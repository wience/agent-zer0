{
  "title": "my.connectSocket",
  "content": "# my.connectSocket\n\n2021-05-09 18:43\n\nUse this API to create a [WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket) connection. An Mini Program can only have one WebSocket connection at a time. If a WebSocket connection already exists when a new one is created, the existing one will be automatically disabled.\n\n## Sample Code\n\ncopy\n\n```javascript\nmy.connectSocket({\n  url: 'test.php',\n  data: {},\n  header:{\n    'content-type': 'application/json'\n  },\n});\n```\n\n**Note:** The case is only for reference. Please use your own URL to test.\n\n## Parameters\n\n|     |     |     |     |\n| --- | --- | --- | --- |\n| **Property** | **Type** | **Required** | **Description** |\n| url | String | Yes | The address of target server interface.<br>**Note:**<br>Some newly released Mini Programs only support WSS protocol. |\n| data | Object | No | The request parameters. |\n| header | Object | No | Header of the request. |\n| success | Function | No | The callback function for a successful API call. |\n| fail | Function | No | The callback function for a failed API call. |\n| complete | Function | No | The callback function used when the API call is completed. This function is always executed no matter the call succeeds or fails. |\n\n## Error Code\n\n|     |     |     |\n| --- | --- | --- |\n| **Error Code** | **Description** | **Solution** |\n| 1 | An unknown error. | - |\n| 2 | A network connection already exists. | An Mini Program can only keep one WebSocket connection for a period of time. If a WebSocket connection already exists when a new one is created, the existing one will be automatically disabled. |\n| 3 | The URL parameter is null. | Replace the URL link. |\n| 4 | An unrecognized URL format. | Replace the  URL link. |\n| 5 | The URL must start with WS or WSS. | Replace the  URL link. |\n| 6 | Connection timed out. | Try again later. |\n| 7 | The HTTPS certificate returned by the server is invalid. | The Mini Program must start a network request using HTTPS/WSS.  When a request is sent, the HTTPS certificate of the server domain name is checked. If the check fails, the request cannot be successfully initiated.  Due to system limitations, different platforms have different requirements for certificates. To ensure the compatibility of Mini Programs,  developers are recommended to configure certificates according to the highest standards and use relevant tools to check existing certificates to ensure that the certificates are valid. |\n| 8 | The protocol header returned by the server is invalid. | Starting from May 2019, newly created Mini Programs must use HTTPS and WSS protocols by default and HTTP and WS protocols are not supported. |\n| 9 | The Sec-WebSocket-Protocol request header is not specified for the WebSocket request. | Please specify the Sec-WebSocket-Protocol request header. |\n| 10 | The network is not available and the message cannot be sent. | Please call [my.sendSocketMessage](https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_network_sendsocketmessage) to send a data message after connecting to the server normally. Use [my.onSocketOpen](https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_network_onsocketopen) to check if the connection with the server is correct.<br>**Note:**<br>To send data through a WebSocket connection, you need to use `my.connectSocket` to start the connection first, and then call [my.sendSocketMessage](https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_network_sendsocketmessage) to send data after the [my.onSocketOpen](https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_network_onsocketopen) callback. |\n| 11 | Failed to send message. | Try again later. |\n| 12 | Unable to request more memory to read network data. | Please check the memory. |",
  "date": "2021-05-09",
  "source": "https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_network_connectsocket",
  "path": "miniprogram_gcash",
  "type": "miniprogram",
  "filename": "miniprogram.gcash.com_docs_miniprogram_gcash_mpdev-old_api_network_connectsocket.json"
}