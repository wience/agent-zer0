{
  "title": "User authorization",
  "content": "# User authorization\n\n2021-05-09 18:43\n\n## Product Description\n\nAll the reading and writing of user information on the site open platform requires the user’s permission before it can be used，user authorization is based on the international standard OAuth2.0 authorization mechanism. Based on this mechanism, developers can obtain site user information etc.\n\n### Terminology\n\n| Terminology | Description | Remark |\n| scope | Scope of authorization | A scope represents the scope of permissions that developers need to request user authorization. A scope contains at least one openapi interface or JSAPI interface. One authorization can combine multiple scopes for combined authorization. |\n| auth\\_code | Authorization code | Temporary user authorization credentials, after obtaining it, please promptly exchange for the authorization token mentioned below. |\n| access\\_token/auth\\_token | Authorization token, or access token | Long-term authorization credentials are used to call the site gateway for server-side authorization interface calls. Need to pay attention to the scope and validity of authorization token. |\n| refresh\\_token | Refresh token | Used to refresh and obtain new authorization token after the authorization token expires, the refresh token also has a validity period. |\n\n### Related products\n\n[**Obtain Basic Member Information**](https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_openapi_obtainbasicmemberinformation)\n\n## Scopes List\n\n| Scopes | Description |\n| USER\\_ID | Authorized to obtain the unique user ID. |\n| USER\\_NICKNAME | Authorized to obtain the user nickname. |\n| USER\\_NAME | Authorized to obtain the user name. |\n| USER\\_LOGIN\\_ID | Authorized to obtain the user login ID. |\n| HASH\\_LOGIN\\_ID | Authorized to obtain the hash user login ID. |\n| USER\\_AVATAR | Authorized to obtain the user avatar. |\n| USER\\_GENDER | Authorized to obtain the user gender. |\n| USER\\_BIRTHDAY | Authorized to obtain the user birthday. |\n| USER\\_NATIONALITY | Authorized to obtain the user nationality. |\n| USER\\_CONTACTINFO | Authorized to obtain the user contact info. |\n| auth\\_base | Authorized to obtain the unique user ID. |\n| auth\\_user | Authorized to obtain user information. |\n\n## Access Guidelines\n\n### Access Process\n\nObtain user information as an example, the overall access process is as follows (if you need to authorize other information, you only need to use a different scope for the scopes parameter when calling getAuthCode).\n\n![User authorization](https://gw.alipayobjects.com/mdn/rms_150082/afts/img/A*bm4uRLKiV9wAAAAAAAAAAABkARQnAQ#alt=image.png)\n\n### App Obtains Authcode\n\nThe user authorization is obtained by calling the jsapi [my.getAuthCode](https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_openapi_getauthcode), and the authcode can be obtained in the success callback. The js code is as follows:\n\ncopy\n\n```javascript\nmy.getAuthCode({\n  scopes: ['USER_ID'],\n  success: (res) => {\n    my.alert({\n      content: res.authCode,\n    });\n  },\n  failed: (res) => {\n      console.log(res.authErrorScopes)\n  },\n});\n```\n\n### Server Obtains Access Token\n\nMerchant server can call `v1/authorizations/applyToken` interface in exchange for the access\\_token，developers can exchange access\\_token and userId with the obtained auth\\_code。auth\\_code as a ticket in exchange for access\\_token。\n\n### Call The Server Business API\n\nAfter obtaining access\\_token, developers can continue to use the token to call other authorization interface. Please pay attention to the permission scope and timeliness of the token.\n\n## API List\n\n| API | API Description |\n| [my.getAuthCode](https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_openapi_getauthcode) | Obtain the authorization code. |\n\n## QA\n\n### Question: Why should developers must use my.getAuthCode API?\n\nAnswer：All the reading and writing of user information on the site open platform requires the user’s permission before it can be used，user authorization is based on the international standard OAuth2.0 authorization mechanism. Based on this mechanism, developers can obtain site user information etc.\n\n### Question: Why is it not allowed to use the user authorization API on the first screen of the Mini Program？\n\nAnswer：In order to create a better Mini Program user experience, guiding user authorization on the first screen of the Mini Program is not allowed. It is necessary to guide the user authorization after the user fully understands the business content of the Mini Program. It is recommended to put the Mini Program authorization in the business process.\n\n### Question: Can the userId be obtained through the user authorization API？\n\nAnswer：No, userId needs to be obtained by calling api on the server side.",
  "date": "2021-05-09",
  "source": "https://miniprogram.gcash.com/docs/miniprogram_gcash/mpdev-old/api_openapi_userauthorization",
  "path": "miniprogram_gcash",
  "type": "miniprogram",
  "filename": "miniprogram.gcash.com_docs_miniprogram_gcash_mpdev-old_api_openapi_userauthorization.json"
}